async function submitOrder() {
    const orderMsg = `${state.uid} ${state.color} ${state.size} +${state.qty}`;
    const encodedMsg = encodeURIComponent(orderMsg);
    const oaUrl = `https://line.me/R/oaMessage/@694nscli/?${encodedMsg}`;

    // 1. 外部瀏覽器直接走跳轉或複製
    if (!liff.isInClient()) {
        window.location.href = oaUrl;
        // 為了保證 100% 成功，也可以同時彈出複製 Modal
        showManualCopyModal(orderMsg);
        return;
    }

    // 2. LINE 內部嘗試 API 發送
    try {
        await liff.sendMessages([{ type: 'text', text: orderMsg }]);
        liff.closeWindow();
    } catch (err) {
        console.error('Send failed:', err);
        
        // 3. 權限失敗時的定向跳轉備援
        if (err.message.includes('permissions') || err.message.includes('grant')) {
            // 引導用戶跳轉到 OA 聊天室
            window.location.href = oaUrl;
        } else {
            // 最終防禦：手動複製
            showManualCopyModal(orderMsg);
        }
    }
}